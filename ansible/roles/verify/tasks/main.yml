---
- name: Check if backend is responding
  uri:
    url: "http://localhost:{{ backend_port }}/api/doctors"
    method: GET
    status_code: [200, 403]
    timeout: 10
  register: backend_check
  ignore_errors: yes

- name: Display backend status
  debug:
    msg: "Backend is {{ 'UP' if backend_check.status == 200 else 'DOWN or requires auth' }}"

- name: Check if frontend is responding
  uri:
    url: "http://localhost:{{ frontend_port }}"
    method: GET
    status_code: [200, 301, 302]
    timeout: 10
  register: frontend_check
  ignore_errors: yes

- name: Display frontend status
  debug:
    msg: "Frontend is {{ 'UP' if frontend_check.status in [200, 301, 302] else 'DOWN' }}"

- name: Get container status
  command: docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"
  register: container_status
  changed_when: false

- name: Display container status
  debug:
    msg: "{{ container_status.stdout_lines }}"

- name: Check Docker Compose services status
  command: docker compose -f {{ project_dir }}/docker-compose.yml ps
  register: compose_status
  changed_when: false
  become_user: "{{ ansible_user }}"

- name: Display services status
  debug:
    msg: "{{ compose_status.stdout_lines }}"

